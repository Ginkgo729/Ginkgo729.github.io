<!DOCTYPE HTML>
<!--
	Dimension by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
 <head>
  <title>
   Dimension by HTML5 UP
  </title>
  <!-- <meta charset="utf-8" /> -->
  <!-- <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" /> -->
  <meta charset="utf-8"/>
  <meta content="width=device-width,initial-scale=1.0" name="viewport"/>
  <link href="../../assets/css/article.css" rel="stylesheet"/>
  <noscript>
   <link href="../../assets/css/noscript.css" rel="stylesheet"/>
  </noscript>
 </head>
 <body>
  <div id="app">
  </div>
  <!-- built files will be auto injected -->
 </body>
 <body class="is-article-visible">
  <!--	<body class="is-preload">-->
  <!-- Wrapper -->
  <div id="wrapper">
   <nav>
    <ul>
     <li>
      <a href="#intro">
       主页
      </a>
     </li>
     <li>
      <a href="#experience">
       文章列表
      </a>
     </li>
    </ul>
   </nav>
   <article class="active" id="article" style="display: block">
    <h1>
     Linux服务编写及服务开机启动
    </h1>
    <hr/>
    <h2>
     一、服务编写
    </h2>
    <h3>
     编写服务脚本
    </h3>
    <p>
     首先用编辑器自己写一个脚本文件，模板和大致的内容如下（简单的按照下面的进行操作即可）：比如写 /etc/init.d/test
    </p>
    <p>
     ```sh
    </p>
    <h1>
     !/bin/bash
    </h1>
    <h3>
     BEGIN INIT INFO
    </h3>
    <h1>
    </h1>
    <h1>
     chkconfig:   2345 90 10
    </h1>
    <h1>
     Provides:  location_server
    </h1>
    <h1>
     Required-Start:   $local_fs  $remote_fs
    </h1>
    <h1>
     Required-Stop:    $local_fs  $remote_fs
    </h1>
    <h1>
     Default-Start:    2 3 4 5
    </h1>
    <h1>
     Default-Stop:     0 1 6
    </h1>
    <h1>
     Short-Description:    initscript
    </h1>
    <h1>
     Description:  This file should be used to construct scripts to be placed in /etc/init.d.
    </h1>
    <h1>
    </h1>
    <h3>
     END INIT INFO
    </h3>
    <h2>
     Fill in name of program here.
    </h2>
    <p>
     PROG="location_server"
PROG_PATH="/opt/location_server" ## Not need, but sometimes helpful (if $PROG resides in /opt for example).
PROG_ARGS="" 
PID_PATH="/var/run/"
    </p>
    <h1>
     上面的保持原样就行，需要写的start和stop函数
    </h1>
    <p>
     start() {
    echo "current PID: $$" #这句删除也可以
    bin/kibana  &gt; kibana.log 2&gt;&amp;1 &amp;
    echo "$!"
    echo "$!" &gt;  /var/run/kibana.pid #将上一个后台进程写入到标准的pid文件和路径中
}
    </p>
    <p>
     stop() {
    if [ -f  "/var/run/kibana.pid" ]; then
        echo "Will kill kibana"
        kill -9
     <pre>cat /var/run/kibana.pid</pre>
     else
        echo "Programe don't run"
    fi
}
    </p>
    <h1>
     下面这些也用改
    </h1>
    <h2>
     Check to see if we are running as root first.
    </h2>
    <h2>
     Found at http://www.cyberciti.biz/tips/shell-root-user-check-script.html
    </h2>
    <p>
     if [ "$(id -u)" != "0" ]; then
    echo "This script must be run as root" 1&gt;&amp;2
    exit 1
fi
    </p>
    <p>
     case "$1" in
    start)
        start
        exit 0
    ;;
    stop)
        stop
        exit 0
    ;;
    reload|restart|force-reload)
        stop
        start
        exit 0
    ;;
    **)
        echo "Usage: $0 {start|stop|reload}" 1&gt;&amp;2
        exit 1
    ;;
esac
```
    </p>
    <h3>
     添加服务
    </h3>
    <p>
     先赋予文件执行权限后使用命令将上面写的test添加到服务里面
    </p>
    <p>
     ```
chmod +x /etc/init.d/test
    </p>
    <h1>
     Ubuntu,Kali下的操作
    </h1>
    <h1>
     update-rc.d 服务名 defaults，并且这样设置服务也就开机启动了
    </h1>
    <p>
     update-rc.d test defaults
    </p>
    <h1>
     删除
    </h1>
    <h1>
     update-rc.d -f 服务名 remove
    </h1>
    <h1>
     CtenOS下的操作
    </h1>
    <p>
     chkconfig --add agent_server
chkconfig agent_server on
```
    </p>
    <h3>
     启动、关闭、重启服务
    </h3>
    <p>
     接下来就可以使用service命令去启动它了
    </p>
    <p>
     ```
    </p>
    <h1>
     service 方式
    </h1>
    <h1>
     service 服务名 start
    </h1>
    <h1>
     service 服务名 stop
    </h1>
    <h1>
     service 服务名 start
    </h1>
    <p>
     service test start
    </p>
    <h1>
     systemctl  方式
    </h1>
    <p>
     systemctl start service
systemctl stop service
systemctl restart service
systemctl status service
```
    </p>
    <h2>
     编写rc.local文件
    </h2>
    <p>
     <pre>chmod +x /etc/rc.d/rc.local
vi /etc/rc.d/rc.local</pre>
    </p>
    <h2>
     参考链接
    </h2>
    <ul>
     <li>
      <a href="https://blog.csdn.net/xiongping_/article/details/50392908">
       update-rc.d的具体用法
      </a>
     </li>
     <li>
      <a href="https://blog.csdn.net/xkjcf/article/details/78698232">
       在Ubuntu下添加自定义服务
      </a>
     </li>
     <li>
      <a href="https://www.cnblogs.com/37yan/p/6962563.html">
       shell 判断文件夹或文件是否存在
      </a>
     </li>
     <li>
      <a href="https://blog.csdn.net/u013066244/article/details/69562364">
       linux后台启动进程并记录进程ID
      </a>
     </li>
    </ul>
   </article>
  </div>
  <!-- BG -->
  <div id="bg">
  </div>
  <!-- Scripts -->
  <script src="../../assets/js/jquery.min.js">
  </script>
  <script src="../../assets/js/browser.min.js">
  </script>
  <script src="../../assets/js/breakpoints.min.js">
  </script>
  <script src="../../assets/js/util.js">
  </script>
  <script src="../../assets/js/main.js">
  </script>
 </body>
</html>
