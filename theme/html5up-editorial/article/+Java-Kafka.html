<!DOCTYPE HTML>
<!--
	Editorial by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
 <head>
  <title>
   Editorial by HTML5 UP
  </title>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1, user-scalable=no" name="viewport"/>
  <link href="../assets/css/main.css" rel="stylesheet"/>
 </head>
 <body class="is-preload">
  <!-- Wrapper -->
  <div id="wrapper">
   <!-- Main -->
   <div id="main">
    <div class="inner">
     <!-- Header -->
     <header id="header">
      <a class="logo" href="../index.html">
       <strong>
        每天进步一点点
       </strong>
      </a>
      <ul class="icons">
       <li>
        <a class="icon brands fa-twitter" href="#">
         <span class="label">
          Twitter
         </span>
        </a>
       </li>
       <li>
        <a class="icon brands fa-facebook-f" href="#">
         <span class="label">
          Facebook
         </span>
        </a>
       </li>
       <li>
        <a class="icon brands fa-snapchat-ghost" href="#">
         <span class="label">
          Snapchat
         </span>
        </a>
       </li>
       <li>
        <a class="icon brands fa-instagram" href="#">
         <span class="label">
          Instagram
         </span>
        </a>
       </li>
       <li>
        <a class="icon brands fa-medium-m" href="#">
         <span class="label">
          Medium
         </span>
        </a>
       </li>
      </ul>
     </header>
     <!-- Banner -->
     <section id="banner">
      <!-- <div class="content"> -->
      <article id="article">
       <h1>
        Java Kafka 简单示例
       </h1>
       <hr/>
       <h2>
        简介
       </h2>
       <p>
        Java kafka 简单代码示例
       </p>
       <h3>
        maven依赖配置
       </h3>
       <p>
        ```java
       </p>
       <!-- kafka -->
       <p>
        <dependency>
         <groupid>
          org.apache.kafka
         </groupid>
         <artifactid>
          kafka-clients
         </artifactid>
         <version>
          0.11.0.0
         </version>
        </dependency>
        ```
       </p>
       <h3>
        kakfa生产和消费者生成
       </h3>
       <p>
        ```java
import org.apache.kafka.clients.consumer.ConsumerRecord;
import org.apache.kafka.clients.consumer.ConsumerRecords;
import org.apache.kafka.clients.consumer.KafkaConsumer;
import org.apache.kafka.clients.producer.KafkaProducer;
import org.apache.kafka.clients.producer.ProducerRecord;
       </p>
       <p>
        import java.util.*;
       </p>
       <p>
        /*
        <em>
         * @author lw1243925457
        </em>
        /
public class KafkaUtil {
       </p>
       <pre><pre>public static KafkaConsumer&lt;String, String&gt; createConsumer(String servers, String topic) {
    Properties properties = new Properties();
    properties.put("bootstrap.servers", servers);
    properties.put("group.id", "group-1");
    properties.put("enable.auto.commit", "false");
    properties.put("auto.commit.interval.ms", "1000");
    properties.put("auto.offset.reset", "earliest");
    properties.put("session.timeout.ms", "30000");
    properties.put("key.deserializer", "org.apache.kafka.common.serialization.StringDeserializer");
    properties.put("value.deserializer", "org.apache.kafka.common.serialization.StringDeserializer");

    KafkaConsumer&lt;String, String&gt; kafkaConsumer = new KafkaConsumer&lt;String, String&gt;(properties);
    kafkaConsumer.subscribe(Arrays.asList(topic));
    return kafkaConsumer;
}

public static void readMessage(KafkaConsumer&lt;String, String&gt; kafkaConsumer, int timeout) {
    while (true) {
        ConsumerRecords&lt;String, String&gt; records = kafkaConsumer.poll(timeout);
        for (ConsumerRecord&lt;String, String&gt; record : records) {
            String value = record.value();
            kafkaConsumer.commitAsync();
            System.out.println(value);
        }
    }
}

public static KafkaProducer&lt;String, String&gt; createProducer(String servers) {
    Properties properties = new Properties();
    properties.put("bootstrap.servers", servers);
    properties.put("acks", "all");
    properties.put("retries", 0);
    properties.put("batch.size", 16384);
    properties.put("linger.ms", 1);
    properties.put("buffer.memory", 33554432);
    properties.put("key.serializer", "org.apache.kafka.common.serialization.StringSerializer");
    properties.put("value.serializer", "org.apache.kafka.common.serialization.StringSerializer");
    return new KafkaProducer&lt;String, String&gt;(properties);
}

public static void send(KafkaProducer&lt;String, String&gt; producer, String topic, String message) {
    producer.send(new ProducerRecord&lt;String, String&gt;(topic, message));
}
</pre></pre>
       <p>
        }
```
       </p>
       <h3>
        运行
       </h3>
       <p>
        ```java
public class Main {
       </p>
       <pre><pre>public static void main(String[] args) {
    String servers = "localhost:9092,localhost:9093,localhost:9094";
    String topic = "TestTopic";
    String message = "test";

    KafkaProducer&lt;String, String&gt; producer = KafkaUtil.createProducer(servers);
    KafkaUtil.send(producer, topic, message);

    KafkaConsumer&lt;String, String&gt; consumer = KafkaUtil.createConsumer(servers, topic);
    KafkaUtil.readMessage(consumer, 100);
}
</pre></pre>
       <p>
        }
```
       </p>
       <h2>
        使用心得
       </h2>
       <h3>
        总是读取最老的消息
       </h3>
       <p>
        可能是group-id的问题，新起一个group-id名称
       </p>
       <ul>
        <li>
         earliest:当各分区下有已提交的offset时，从提交的offset开始消费；无提交的offset时，从头开始消费
        </li>
        <li>
         latest:当各分区下有已提交的offset时，从提交的offset开始消费；无提交的offset时，消费新产生的该分区下的数据
        </li>
        <li>
         none:topic各分区都存在已提交的offset时，从offset后开始消费；只要有一个分区不存在已提交的offset，则抛出异常
        </li>
       </ul>
       <h2>
        参考链接
       </h2>
       <ul>
        <li>
         <a href="https://blog.csdn.net/beExcellentOne/article/details/53641953">
          java 实现kafka消息生产者和消费者
         </a>
        </li>
        <li>
         <a href="https://segmentfault.com/a/1190000015886487">
          kafka（三）—Kafka的Java代码示例和配置说明
         </a>
        </li>
        <li>
         <a href="https://blog.csdn.net/u011669700/article/details/80053313">
          Kafka - 偏移量提交
         </a>
        </li>
        <li>
         <a href="http://www.dengshenyu.com/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F/2017/11/14/kafka-consumer.html">
          Kafka系列（四）Kafka消费者：从Kafka中读取数据
         </a>
        </li>
        <li>
         <a href="https://blog.csdn.net/lishuangzhe7047/article/details/74530417">
          Kafka auto.offset.reset值详解
         </a>
        </li>
       </ul>
      </article>
      <!-- </div> -->
     </section>
    </div>
   </div>
   <!-- Sidebar -->
   <div id="sidebar">
    <div class="inner">
     <!-- Menu -->
     <nav id="menu">
      <header class="major">
       <h2>
        目录
       </h2>
      </header>
      <ul>
       <li>
        <span class="opener">
         系统与软件
        </span>
        <ul>
         <li>
          <span class="opener">
           linux
          </span>
          <ul>
           <li>
            <a href="index.html">
             zsh.md
            </a>
           </li>
          </ul>
         </li>
         <li>
          <span class="opener">
           software
          </span>
          <ul>
           <li>
            <span class="opener">
             vscode
            </span>
            <ul>
             <li>
              <a href="index.html">
               vscode使用配置记录.md
              </a>
             </li>
            </ul>
           </li>
          </ul>
         </li>
         <li>
          <span class="opener">
           windows
          </span>
          <ul>
           <li>
            <a href="index.html">
             winSh中使用vim.md
            </a>
           </li>
          </ul>
         </li>
        </ul>
       </li>
       <li>
        <span class="opener">
         编程类
        </span>
        <ul>
         <li>
          <span class="opener">
           C++
          </span>
          <ul>
           <li>
            <a href="index.html">
             windows环境配置.md
            </a>
           </li>
          </ul>
         </li>
         <li>
          <span class="opener">
           git
          </span>
          <ul>
           <li>
            <a href="index.html">
             gitlab-CI.md
            </a>
           </li>
          </ul>
         </li>
         <li>
          <span class="opener">
           GoLang
          </span>
          <ul>
           <li>
            <a href="index.html">
             Go设置使用记录.md
            </a>
           </li>
          </ul>
         </li>
         <li>
          <span class="opener">
           java
          </span>
          <ul>
           <li>
            <span class="opener">
             spring
            </span>
            <ul>
             <li>
              <a href="index.html">
               SpringBoot-Mybatis-MySQL主从分离读写.md
              </a>
             </li>
            </ul>
           </li>
          </ul>
         </li>
         <li>
          <span class="opener">
           openCV
          </span>
          <ul>
           <li>
            <a href="index.html">
             轮廓检测.md
            </a>
           </li>
          </ul>
         </li>
         <li>
          <span class="opener">
           python
          </span>
          <ul>
           <li>
            <a href="index.html">
             Python3常用记录.md
            </a>
           </li>
          </ul>
         </li>
         <li>
          <span class="opener">
           SFML
          </span>
          <ul>
           <li>
            <a href="index.html">
             SFML与VS2015配置.md
            </a>
           </li>
          </ul>
         </li>
         <li>
          <span class="opener">
           人工智能
          </span>
          <ul>
           <li>
            <span class="opener">
             机器学习
            </span>
            <ul>
             <li>
              <a href="index.html">
               朴素贝叶斯分类器.md
              </a>
             </li>
            </ul>
           </li>
          </ul>
         </li>
         <li>
          <span class="opener">
           前端
          </span>
          <ul>
           <li>
            <a href="index.html">
             vue打包直接访问.md
            </a>
           </li>
          </ul>
         </li>
         <li>
          <span class="opener">
           开源
          </span>
          <ul>
           <li>
            <span class="opener">
             soul
            </span>
            <ul>
             <li>
              <a href="index.html">
               soul源码解析9-插件配置加载初探.md
              </a>
             </li>
            </ul>
           </li>
          </ul>
         </li>
        </ul>
       </li>
       <li>
        <span class="opener">
         通用类
        </span>
        <ul>
         <li>
          <a href="index.html">
           搜索技巧总结.md
          </a>
         </li>
        </ul>
       </li>
      </ul>
     </nav>
    </div>
   </div>
  </div>
  <!-- Scripts -->
  <script src="../assets/js/jquery.min.js">
  </script>
  <script src="../assets/js/browser.min.js">
  </script>
  <script src="../assets/js/breakpoints.min.js">
  </script>
  <script src="../assets/js/util.js">
  </script>
  <script src="../assets/js/main.js">
  </script>
 </body>
</html>