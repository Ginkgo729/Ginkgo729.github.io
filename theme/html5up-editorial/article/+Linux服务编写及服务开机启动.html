<!DOCTYPE HTML>
<!--
	Editorial by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
 <head>
  <title>
   Editorial by HTML5 UP
  </title>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1, user-scalable=no" name="viewport"/>
  <link href="../assets/css/main.css" rel="stylesheet"/>
 </head>
 <body class="is-preload">
  <!-- Wrapper -->
  <div id="wrapper">
   <!-- Main -->
   <div id="main">
    <div class="inner">
     <!-- Header -->
     <header id="header">
      <a class="logo" href="../index.html">
       <strong>
        每天进步一点点
       </strong>
      </a>
      <ul class="icons">
       <li>
        <a class="icon brands fa-twitter" href="#">
         <span class="label">
          Twitter
         </span>
        </a>
       </li>
       <li>
        <a class="icon brands fa-facebook-f" href="#">
         <span class="label">
          Facebook
         </span>
        </a>
       </li>
       <li>
        <a class="icon brands fa-snapchat-ghost" href="#">
         <span class="label">
          Snapchat
         </span>
        </a>
       </li>
       <li>
        <a class="icon brands fa-instagram" href="#">
         <span class="label">
          Instagram
         </span>
        </a>
       </li>
       <li>
        <a class="icon brands fa-medium-m" href="#">
         <span class="label">
          Medium
         </span>
        </a>
       </li>
      </ul>
     </header>
     <!-- Banner -->
     <section id="banner">
      <!-- <div class="content"> -->
      <article id="article">
       <h1>
        Linux服务编写及服务开机启动
       </h1>
       <hr/>
       <h2>
        一、服务编写
       </h2>
       <h3>
        编写服务脚本
       </h3>
       <p>
        首先用编辑器自己写一个脚本文件，模板和大致的内容如下（简单的按照下面的进行操作即可）：比如写 /etc/init.d/test
       </p>
       <p>
        ```sh
       </p>
       <h1>
        !/bin/bash
       </h1>
       <h3>
        BEGIN INIT INFO
       </h3>
       <h1>
       </h1>
       <h1>
        chkconfig:   2345 90 10
       </h1>
       <h1>
        Provides:  location_server
       </h1>
       <h1>
        Required-Start:   $local_fs  $remote_fs
       </h1>
       <h1>
        Required-Stop:    $local_fs  $remote_fs
       </h1>
       <h1>
        Default-Start:    2 3 4 5
       </h1>
       <h1>
        Default-Stop:     0 1 6
       </h1>
       <h1>
        Short-Description:    initscript
       </h1>
       <h1>
        Description:  This file should be used to construct scripts to be placed in /etc/init.d.
       </h1>
       <h1>
       </h1>
       <h3>
        END INIT INFO
       </h3>
       <h2>
        Fill in name of program here.
       </h2>
       <p>
        PROG="location_server"
PROG_PATH="/opt/location_server" ## Not need, but sometimes helpful (if $PROG resides in /opt for example).
PROG_ARGS="" 
PID_PATH="/var/run/"
       </p>
       <h1>
        上面的保持原样就行，需要写的start和stop函数
       </h1>
       <p>
        start() {
    echo "current PID: $$" #这句删除也可以
    bin/kibana  &gt; kibana.log 2&gt;&amp;1 &amp;
    echo "$!"
    echo "$!" &gt;  /var/run/kibana.pid #将上一个后台进程写入到标准的pid文件和路径中
}
       </p>
       <p>
        stop() {
    if [ -f  "/var/run/kibana.pid" ]; then
        echo "Will kill kibana"
        kill -9
        <pre>cat /var/run/kibana.pid</pre>
        else
        echo "Programe don't run"
    fi
}
       </p>
       <h1>
        下面这些也用改
       </h1>
       <h2>
        Check to see if we are running as root first.
       </h2>
       <h2>
        Found at http://www.cyberciti.biz/tips/shell-root-user-check-script.html
       </h2>
       <p>
        if [ "$(id -u)" != "0" ]; then
    echo "This script must be run as root" 1&gt;&amp;2
    exit 1
fi
       </p>
       <p>
        case "$1" in
    start)
        start
        exit 0
    ;;
    stop)
        stop
        exit 0
    ;;
    reload|restart|force-reload)
        stop
        start
        exit 0
    ;;
    **)
        echo "Usage: $0 {start|stop|reload}" 1&gt;&amp;2
        exit 1
    ;;
esac
```
       </p>
       <h3>
        添加服务
       </h3>
       <p>
        先赋予文件执行权限后使用命令将上面写的test添加到服务里面
       </p>
       <p>
        ```
chmod +x /etc/init.d/test
       </p>
       <h1>
        Ubuntu,Kali下的操作
       </h1>
       <h1>
        update-rc.d 服务名 defaults，并且这样设置服务也就开机启动了
       </h1>
       <p>
        update-rc.d test defaults
       </p>
       <h1>
        删除
       </h1>
       <h1>
        update-rc.d -f 服务名 remove
       </h1>
       <h1>
        CtenOS下的操作
       </h1>
       <p>
        chkconfig --add agent_server
chkconfig agent_server on
```
       </p>
       <h3>
        启动、关闭、重启服务
       </h3>
       <p>
        接下来就可以使用service命令去启动它了
       </p>
       <p>
        ```
       </p>
       <h1>
        service 方式
       </h1>
       <h1>
        service 服务名 start
       </h1>
       <h1>
        service 服务名 stop
       </h1>
       <h1>
        service 服务名 start
       </h1>
       <p>
        service test start
       </p>
       <h1>
        systemctl  方式
       </h1>
       <p>
        systemctl start service
systemctl stop service
systemctl restart service
systemctl status service
```
       </p>
       <h2>
        编写rc.local文件
       </h2>
       <p>
        <pre>chmod +x /etc/rc.d/rc.local
vi /etc/rc.d/rc.local</pre>
       </p>
       <h2>
        参考链接
       </h2>
       <ul>
        <li>
         <a href="https://blog.csdn.net/xiongping_/article/details/50392908">
          update-rc.d的具体用法
         </a>
        </li>
        <li>
         <a href="https://blog.csdn.net/xkjcf/article/details/78698232">
          在Ubuntu下添加自定义服务
         </a>
        </li>
        <li>
         <a href="https://www.cnblogs.com/37yan/p/6962563.html">
          shell 判断文件夹或文件是否存在
         </a>
        </li>
        <li>
         <a href="https://blog.csdn.net/u013066244/article/details/69562364">
          linux后台启动进程并记录进程ID
         </a>
        </li>
       </ul>
      </article>
      <!-- </div> -->
     </section>
    </div>
   </div>
   <!-- Sidebar -->
   <div id="sidebar">
    <div class="inner">
     <!-- Menu -->
     <nav id="menu">
      <header class="major">
       <h2>
        目录
       </h2>
      </header>
      <ul>
       <li>
        <span class="opener">
         系统与软件
        </span>
        <ul>
         <li>
          <span class="opener">
           linux
          </span>
          <ul>
           <li>
            <a href="index.html">
             zsh.md
            </a>
           </li>
          </ul>
         </li>
         <li>
          <span class="opener">
           software
          </span>
          <ul>
           <li>
            <span class="opener">
             vscode
            </span>
            <ul>
             <li>
              <a href="index.html">
               vscode使用配置记录.md
              </a>
             </li>
            </ul>
           </li>
          </ul>
         </li>
         <li>
          <span class="opener">
           windows
          </span>
          <ul>
           <li>
            <a href="index.html">
             winSh中使用vim.md
            </a>
           </li>
          </ul>
         </li>
        </ul>
       </li>
       <li>
        <span class="opener">
         编程类
        </span>
        <ul>
         <li>
          <span class="opener">
           C++
          </span>
          <ul>
           <li>
            <a href="index.html">
             windows环境配置.md
            </a>
           </li>
          </ul>
         </li>
         <li>
          <span class="opener">
           git
          </span>
          <ul>
           <li>
            <a href="index.html">
             gitlab-CI.md
            </a>
           </li>
          </ul>
         </li>
         <li>
          <span class="opener">
           GoLang
          </span>
          <ul>
           <li>
            <a href="index.html">
             Go设置使用记录.md
            </a>
           </li>
          </ul>
         </li>
         <li>
          <span class="opener">
           java
          </span>
          <ul>
           <li>
            <span class="opener">
             spring
            </span>
            <ul>
             <li>
              <a href="index.html">
               SpringBoot-Mybatis-MySQL主从分离读写.md
              </a>
             </li>
            </ul>
           </li>
          </ul>
         </li>
         <li>
          <span class="opener">
           openCV
          </span>
          <ul>
           <li>
            <a href="index.html">
             轮廓检测.md
            </a>
           </li>
          </ul>
         </li>
         <li>
          <span class="opener">
           python
          </span>
          <ul>
           <li>
            <a href="index.html">
             Python3常用记录.md
            </a>
           </li>
          </ul>
         </li>
         <li>
          <span class="opener">
           SFML
          </span>
          <ul>
           <li>
            <a href="index.html">
             SFML与VS2015配置.md
            </a>
           </li>
          </ul>
         </li>
         <li>
          <span class="opener">
           人工智能
          </span>
          <ul>
           <li>
            <span class="opener">
             机器学习
            </span>
            <ul>
             <li>
              <a href="index.html">
               朴素贝叶斯分类器.md
              </a>
             </li>
            </ul>
           </li>
          </ul>
         </li>
         <li>
          <span class="opener">
           前端
          </span>
          <ul>
           <li>
            <a href="index.html">
             vue打包直接访问.md
            </a>
           </li>
          </ul>
         </li>
         <li>
          <span class="opener">
           开源
          </span>
          <ul>
           <li>
            <span class="opener">
             soul
            </span>
            <ul>
             <li>
              <a href="index.html">
               soul源码解析9-插件配置加载初探.md
              </a>
             </li>
            </ul>
           </li>
          </ul>
         </li>
        </ul>
       </li>
       <li>
        <span class="opener">
         通用类
        </span>
        <ul>
         <li>
          <a href="index.html">
           搜索技巧总结.md
          </a>
         </li>
        </ul>
       </li>
      </ul>
     </nav>
    </div>
   </div>
  </div>
  <!-- Scripts -->
  <script src="../assets/js/jquery.min.js">
  </script>
  <script src="../assets/js/browser.min.js">
  </script>
  <script src="../assets/js/breakpoints.min.js">
  </script>
  <script src="../assets/js/util.js">
  </script>
  <script src="../assets/js/main.js">
  </script>
 </body>
</html>