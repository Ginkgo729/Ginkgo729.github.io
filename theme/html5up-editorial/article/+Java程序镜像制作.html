<!DOCTYPE HTML>
<!--
	Editorial by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
 <head>
  <title>
   Editorial by HTML5 UP
  </title>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1, user-scalable=no" name="viewport"/>
  <link href="../assets/css/main.css" rel="stylesheet"/>
 </head>
 <body class="is-preload">
  <!-- Wrapper -->
  <div id="wrapper">
   <!-- Main -->
   <div id="main">
    <div class="inner">
     <!-- Header -->
     <header id="header">
      <a class="logo" href="../index.html">
       <strong>
        每天进步一点点
       </strong>
      </a>
      <ul class="icons">
       <li>
        <a class="icon brands fa-twitter" href="#">
         <span class="label">
          Twitter
         </span>
        </a>
       </li>
       <li>
        <a class="icon brands fa-facebook-f" href="#">
         <span class="label">
          Facebook
         </span>
        </a>
       </li>
       <li>
        <a class="icon brands fa-snapchat-ghost" href="#">
         <span class="label">
          Snapchat
         </span>
        </a>
       </li>
       <li>
        <a class="icon brands fa-instagram" href="#">
         <span class="label">
          Instagram
         </span>
        </a>
       </li>
       <li>
        <a class="icon brands fa-medium-m" href="#">
         <span class="label">
          Medium
         </span>
        </a>
       </li>
      </ul>
     </header>
     <!-- Banner -->
     <section id="banner">
      <!-- <div class="content"> -->
      <article id="article">
       <h1>
        Docker Java程序镜像制作
       </h1>
       <hr/>
       <h2>
        制作前的准备
       </h2>
       <ul>
        <li>
         jre：不需要完整的jdk，jre即可，到Oracle进行下载即可，
         <a href="https://www.oracle.com/technetwork/java/javase/downloads/jre8-downloads-2133155.html">
          下载链接
         </a>
         ,根据自己的情况进行选择，这里选择jre-8u221-linux-x64.tar.gz，一般只能使用解压安装了，rpm的可以直接使用yum命令进行安装，但我们这里用不了
        </li>
        <li>
         jar包：自己写好的程序的可执行jar，放到镜像中直接运行即可
        </li>
       </ul>
       <h2>
        制作步骤
       </h2>
       <ul>
        <li>
         mkdir docker：创建一个制作镜像的工作目录，里面用于存放构建镜像需要的文件，如jre和jar包，还有镜像构建文件Dockfile
        </li>
        <li>
         在目录下放入jar包和jre
        </li>
        <li>
         生产Dockfile文件并进行编写，编写示例和说明如下,下面的操作环境是centos7
        </li>
       </ul>
       <p>
        ```bash
       </p>
       <h1>
        创建镜像制作目录
       </h1>
       <p>
        mkdir docker
cd docker
       </p>
       <h1>
        将oracle的jre包和生成好的程序jar放到目录中
       </h1>
       <h1>
        为了制造较小体积的镜像，不使用jdk包，也没有必要使用它
       </h1>
       <p>
        cp ../jre-8u221-linux-x64.tar.gz ./
cp ../seckill-1.0-SNAPSHOT.jar ./
       </p>
       <h1>
        创建并编辑编辑Dockfile镜像生成文件
       </h1>
       <p>
        vim Dockerfile
       </p>
       <h1>
        将下面的内容写入文件中，详细的东西在后面会有说明
       </h1>
       <p>
        FROM docker.io/jeanblanchard/alpine-glibc
ADD jre-8u221-linux-x64.tar.gz /usr/java/jdk
ENV JAVA_HOME /usr/java/jdk/jre1.8.0_221
ENV PATH ${PATH}:${JAVA_HOME}/bin
COPY seckill-1.0-SNAPSHOT.jar /home/seckill-1.0-SNAPSHOT.jar
CMD java -jar /home/seckill-1.0-SNAPSHOT.jar
       </p>
       <h1>
        生成名称为seckill，版本为v0的镜像
       </h1>
       <p>
        docker build -t seckill:v0 .
       </p>
       <h1>
        运行镜像，我的Java程序是监听在8080端口的，所以将镜像容器的8080端口映射到宿主机的8080，并命名容器的名称为seckill
       </h1>
       <p>
        docker run --name seckill -p 8080:8080 seckill
       </p>
       <h1>
        查看当前seckill容器的输出，这里会打印显示Java的控制台输出内容
       </h1>
       <p>
        docker logs seckill
```
       </p>
       <p>
        下面讲解下Dockfile文件的内容：
       </p>
       <ul>
        <li>
         FROM docker.io/jeanblanchard/alpine-glibc：docker的linux镜像有很多，比如Ubuntu、centos之类的，但他们的体积都比较大，单纯一个镜像的都是400M以上的，而其中的alpine镜像只用不到10M，非常的小巧，所以这里就选用它作为基础的构建镜像。但是alpine是基于MUSL libs（mini libc）的，而Java是基于GUN Standard C （glibc）library的，如果不做任何处理的话Java不能在其上运行，而在网上有大佬已经制造安装了glibc的alpine镜像，我们直接使用即可
        </li>
        <li>
         ADD jre-8u221-linux-x64.tar.gz /usr/java/jdk：解压并添加jre压缩包到/usr/java/jdk目录下
        </li>
        <li>
         ENV JAVA_HOME /usr/java/jdk/jre1.8.0_221、ENV PATH ${PATH}:${JAVA_HOME}/bin:这种Java环境变量，这里踩过一个坑，需要注意的是JAVA_HOME的路径设置，如果你的jre包的版本和我不一样话，需要进行修改，我这里解压后是jre1.8.0_221
        </li>
        <li>
         COPY seckill-1.0-SNAPSHOT.jar /home/seckill-1.0-SNAPSHOT.jar：复制添加Java程序到指定目录
        </li>
        <li>
         CMD java -jar /home/seckill-1.0-SNAPSHOT.jar：设置在容器运行后启动Java程序
        </li>
       </ul>
       <p>
        如果对docker不是太了解的话，可以查看下面的我制作过程中参考的链接
       </p>
       <h2>
        参考链接
       </h2>
       <ul>
        <li>
         <a href="https://blog.csdn.net/Dannyvon/article/details/80092834">
          Alpine制作JDK8镜像的坑
         </a>
        </li>
        <li>
         <a href="https://www.infoq.cn/article/3-simple-tricks-for-smaller-docker-images">
          三个技巧，将 Docker 镜像体积减小 90%
         </a>
        </li>
        <li>
         <a href="https://zhuanlan.zhihu.com/p/38552260">
          Docker最佳实践：构建最小镜像
         </a>
        </li>
        <li>
         <a href="https://hub.docker.com/_/alpine/">
          alpine
         </a>
        </li>
        <li>
         <a href="https://yeasy.gitbooks.io/docker_practice/image/build.html">
          使用 Dockerfile 定制镜像
         </a>
        </li>
        <li>
         <a href="https://www.cnblogs.com/sparkdev/p/9573248.html">
          Dockerfile 中的 COPY 与 ADD 命令
         </a>
        </li>
        <li>
         <a href="https://www.java.com/en/download/manual.jsp">
          jre 下载
         </a>
        </li>
        <li>
         <a href="https://blog.csdn.net/AaronSimon/article/details/82711629">
          构建最小JDK Docker镜像
         </a>
        </li>
       </ul>
      </article>
      <!-- </div> -->
     </section>
    </div>
   </div>
   <!-- Sidebar -->
   <div id="sidebar">
    <div class="inner">
     <!-- Menu -->
     <nav id="menu">
      <header class="major">
       <h2>
        目录
       </h2>
      </header>
      <ul>
       <li>
        <span class="opener">
         linux
        </span>
        <ul>
         <li>
          <a href="index.html">
           centos.md
          </a>
         </li>
         <li>
          <a href="index.html">
           iptables端口转发与映射.md
          </a>
         </li>
         <li>
          <a href="index.html">
           Java安装.md
          </a>
         </li>
         <li>
          <a href="index.html">
           linux-时间校准.md
          </a>
         </li>
         <li>
          <a href="index.html">
           Linux服务编写及服务开机启动.md
          </a>
         </li>
         <li>
          <a href="index.html">
           shadowsocks.md
          </a>
         </li>
         <li>
          <a href="index.html">
           ssh隧道.md
          </a>
         </li>
         <li>
          <a href="index.html">
           supervisor使用.md
          </a>
         </li>
         <li>
          <a href="index.html">
           yapi.md
          </a>
         </li>
         <li>
          <a href="index.html">
           zsh.md
          </a>
         </li>
        </ul>
       </li>
       <li>
        <span class="opener">
         software
        </span>
        <ul>
         <li>
          <span class="opener">
           docker
          </span>
          <ul>
           <li>
            <a href="index.html">
             Java程序镜像制作.md
            </a>
           </li>
          </ul>
         </li>
         <li>
          <span class="opener">
           jetbranins
          </span>
          <ul>
           <li>
            <a href="index.html">
             Pycharm使用记录.md
            </a>
           </li>
          </ul>
         </li>
         <li>
          <span class="opener">
           kafka
          </span>
          <ul>
           <li>
            <a href="index.html">
             kafkaDocker集群搭建.md
            </a>
           </li>
          </ul>
         </li>
         <li>
          <span class="opener">
           MongoDB
          </span>
          <ul>
           <li>
            <a href="index.html">
             Python-MongoDB.md
            </a>
           </li>
          </ul>
         </li>
         <li>
          <span class="opener">
           MySQL
          </span>
          <ul>
           <li>
            <a href="index.html">
             MySQL使用记录.md
            </a>
           </li>
          </ul>
         </li>
         <li>
          <span class="opener">
           nagios
          </span>
          <ul>
           <li>
            <a href="index.html">
             nagios添加主机和服务监控说明.md
            </a>
           </li>
          </ul>
         </li>
         <li>
          <span class="opener">
           neo4j
          </span>
          <ul>
           <li>
            <a href="index.html">
             neo4j使用记录.md
            </a>
           </li>
          </ul>
         </li>
         <li>
          <span class="opener">
           nginx
          </span>
          <ul>
           <li>
            <a href="index.html">
             nginx负载均衡.md
            </a>
           </li>
          </ul>
         </li>
         <li>
          <span class="opener">
           Redis
          </span>
          <ul>
           <li>
            <a href="index.html">
             Redis知识总览.md
            </a>
           </li>
          </ul>
         </li>
         <li>
          <span class="opener">
           snort
          </span>
          <ul>
           <li>
            <a href="index.html">
             Snort调研.md
            </a>
           </li>
          </ul>
         </li>
         <li>
          <span class="opener">
           sublimeText
          </span>
          <ul>
           <li>
            <a href="index.html">
             ubuntu16.04_install.md
            </a>
           </li>
          </ul>
         </li>
         <li>
          <span class="opener">
           vim
          </span>
          <ul>
           <li>
            <a href="index.html">
             Ctenos7-vim8安装.md
            </a>
           </li>
          </ul>
         </li>
         <li>
          <span class="opener">
           virsual_studio
          </span>
          <ul>
           <li>
            <a href="index.html">
             插件安装篇.md
            </a>
           </li>
          </ul>
         </li>
         <li>
          <span class="opener">
           vscode
          </span>
          <ul>
           <li>
            <a href="index.html">
             vscode使用配置记录.md
            </a>
           </li>
          </ul>
         </li>
        </ul>
       </li>
       <li>
        <span class="opener">
         windows
        </span>
        <ul>
         <li>
          <a href="index.html">
           superbenchmarker.md
          </a>
         </li>
         <li>
          <a href="index.html">
           windows10.md
          </a>
         </li>
         <li>
          <a href="index.html">
           winSh中使用vim.md
          </a>
         </li>
        </ul>
       </li>
       <li>
        <span class="opener">
         C++
        </span>
        <ul>
         <li>
          <a href="index.html">
           windows环境配置.md
          </a>
         </li>
        </ul>
       </li>
       <li>
        <span class="opener">
         git
        </span>
        <ul>
         <li>
          <a href="index.html">
           gitlab-CI.md
          </a>
         </li>
        </ul>
       </li>
       <li>
        <span class="opener">
         GoLang
        </span>
        <ul>
         <li>
          <a href="index.html">
           Go设置使用记录.md
          </a>
         </li>
        </ul>
       </li>
       <li>
        <span class="opener">
         java
        </span>
        <ul>
         <li>
          <span class="opener">
           shardingsphere
          </span>
          <ul>
           <li>
            <a href="index.html">
             ShardingSphereProxy分库分表.md
            </a>
           </li>
          </ul>
         </li>
         <li>
          <span class="opener">
           spring
          </span>
          <ul>
           <li>
            <a href="index.html">
             SpringBoot-Mybatis-MySQL主从分离读写.md
            </a>
           </li>
          </ul>
         </li>
        </ul>
       </li>
       <li>
        <span class="opener">
         openCV
        </span>
        <ul>
         <li>
          <a href="index.html">
           轮廓检测.md
          </a>
         </li>
        </ul>
       </li>
       <li>
        <span class="opener">
         python
        </span>
        <ul>
         <li>
          <a href="index.html">
           Python3常用记录.md
          </a>
         </li>
        </ul>
       </li>
       <li>
        <span class="opener">
         SFML
        </span>
        <ul>
         <li>
          <a href="index.html">
           SFML与VS2015配置.md
          </a>
         </li>
        </ul>
       </li>
       <li>
        <span class="opener">
         人工智能
        </span>
        <ul>
         <li>
          <span class="opener">
           机器学习
          </span>
          <ul>
           <li>
            <a href="index.html">
             朴素贝叶斯分类器.md
            </a>
           </li>
          </ul>
         </li>
        </ul>
       </li>
       <li>
        <span class="opener">
         前端
        </span>
        <ul>
         <li>
          <a href="index.html">
           vue打包直接访问.md
          </a>
         </li>
        </ul>
       </li>
       <li>
        <span class="opener">
         开源
        </span>
        <ul>
         <li>
          <span class="opener">
           soul
          </span>
          <ul>
           <li>
            <a href="index.html">
             soul源码解析9-插件配置加载初探.md
            </a>
           </li>
          </ul>
         </li>
        </ul>
       </li>
      </ul>
     </nav>
    </div>
   </div>
  </div>
  <!-- Scripts -->
  <script src="../assets/js/jquery.min.js">
  </script>
  <script src="../assets/js/browser.min.js">
  </script>
  <script src="../assets/js/breakpoints.min.js">
  </script>
  <script src="../assets/js/util.js">
  </script>
  <script src="../assets/js/main.js">
  </script>
 </body>
</html>